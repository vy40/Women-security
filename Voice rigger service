VoiceTriggerService.java 

package com.yourappname; 
import android.Manifest; 
import android.app.Notification; 
import android.app.NotificationChannel; 
import android.app.NotificationManager; 
import android.app.Service; 
import android.content.Intent; 
import android.content.pm.PackageManager; 
import android.os.Build; 
import android.os.Bundle; 
import android.os.Handler; 
import android.os.IBinder; 
import android.speech.RecognitionListener; 
import android.speech.RecognizerIntent; 
import android.speech.SpeechRecognizer; 
import android.widget.Toast; 
import androidx.core.app.NotificationCompat; 
import androidx.core.content.ContextCompat; 
import java.util.ArrayList; 
import java.util.Locale; 
public class VoiceTriggerService extends Service { 
private static final String CHANNEL_ID = "VoiceTriggerChannel"; 
private static final int NOTIFICATION_ID = 101; 
27 
28 
 
    private SpeechRecognizer speechRecognizer; 
    private Intent recognizerIntent; 
    private Handler handler = new Handler(); 
 
    @Override 
    public void onCreate() { 
        super.onCreate(); 
 
        if (!hasMicrophonePermission()) { 
            stopSelf(); 
            return; 
        } 
 
        setupForegroundService(); 
        initializeSpeechRecognizer(); 
        startListening(); 
    } 
 
    private boolean hasMicrophonePermission() { 
        return ContextCompat.checkSelfPermission(this, 
                Manifest.permission.RECORD_AUDIO) == 
PackageManager.PERMISSION_GRANTED; 
    } 
 
    private void setupForegroundService() { 
        createNotificationChannel(); 
        Notification notification = new NotificationCompat.Builder(this, CHANNEL_ID) 
                .setContentTitle("Voice Trigger Active") 
                .setContentText("Listening for 'Help'") 
                .setSmallIcon(R.drawable.ic_notification) // ensure you have this icon 
                .setPriority(NotificationCompat.PRIORITY_LOW) 
                .setOngoing(true) 
                .build(); 
        startForeground(NOTIFICATION_ID, notification); 
    } 
 
    private void createNotificationChannel() { 
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) { 
            NotificationChannel channel = new NotificationChannel( 
                    CHANNEL_ID, 
                    "Voice Trigger Channel", 
                    NotificationManager.IMPORTANCE_LOW 
            ); 
            NotificationManager manager = getSystemService(NotificationManager.class); 
            if (manager != null) { 
                manager.createNotificationChannel(channel); 
            } 
        } 
29 
 
    } 
 
    private void initializeSpeechRecognizer() { 
        speechRecognizer = SpeechRecognizer.createSpeechRecognizer(this); 
        speechRecognizer.setRecognitionListener(new RecognitionListener() { 
            @Override public void onReadyForSpeech(Bundle params) {} 
            @Override public void onBeginningOfSpeech() {} 
            @Override public void onRmsChanged(float rmsdB) {} 
            @Override public void onBufferReceived(byte[] buffer) {} 
            @Override public void onEndOfSpeech() {} 
            @Override public void onPartialResults(Bundle partialResults) {} 
            @Override public void onEvent(int eventType, Bundle params) {} 
 
            @Override 
            public void onError(int error) { 
                restartListeningWithDelay(); // always restart 
            } 
 
            @Override 
            public void onResults(Bundle results) { 
                ArrayList<String> matches = 
results.getStringArrayList(SpeechRecognizer.RESULTS_RECOGNITION); 
                if (matches != null) { 
                    for (String result : matches) { 
                        if (result.toLowerCase().contains("help")) { 
                            triggerSOS(); 
                            break; 
                        } 
                    } 
                } 
                restartListeningWithDelay(); 
            } 
        }); 
 
        recognizerIntent = new Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH); 
        recognizerIntent.putExtra(RecognizerIntent.EXTRA_LANGUAGE_MODEL, 
RecognizerIntent.LANGUAGE_MODEL_FREE_FORM); 
        recognizerIntent.putExtra(RecognizerIntent.EXTRA_LANGUAGE, Locale.getDefault()); 
        recognizerIntent.putExtra(RecognizerIntent.EXTRA_CALLING_PACKAGE, 
getPackageName()); 
    } 
 
    private void startListening() { 
        if (speechRecognizer != null) { 
            speechRecognizer.startListening(recognizerIntent); 
        } 
    } 
 
private void restartListeningWithDelay() { 
if (speechRecognizer != null) { 
speechRecognizer.cancel(); 
} 
handler.postDelayed(this::startListening, 10); // delay before restarting 
} 
private void triggerSOS() { 
Intent sosIntent = new Intent(this, MainActivity.class); 
sosIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); 
sosIntent.putExtra("trigger_sos", true); 
startActivity(sosIntent); 
} 
@Override 
public void onDestroy() { 
if (speechRecognizer != null) { 
speechRecognizer.cancel(); 
speechRecognizer.destroy(); 
} 
super.onDestroy(); 
} 
@Override 
public IBinder onBind(Intent intent) { 
return null; 
} 
} 
